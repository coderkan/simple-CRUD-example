<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="custom/autocomp/jquery-ui.css">
	<script src="custom/autocomp/jquery-1.12.4.js"></script>
	<script src="custom/autocomp/jquery-ui.js"></script>
 
	<!-- CSS Files -->
	<link rel="icon" type="image/png" href="custom/images/icons/favicon.ico"/> 

	<link rel="stylesheet" type="text/css" href="custom/vendor/boostrap337/dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="custom/fonts/font-awesome-4.7.0/css/font-awesome.min.css">

 	<!-- External CSS -->
 	<link rel="stylesheet" type="text/css" href="mstyle.css">
  
	<!-- Scripts -->
	<script  type="text/javascript" src="custom/vendor/bootstrap/js/popper.js"></script>
	<script  type="text/javascript" src="custom/vendor/boostrap337/dist/js/bootstrap.min.js"></script>
	<script  type="text/javascript" src="custom/vendor/select2/select2.min.js"></script>

    <style>
        input[type=text]:disabled {
            background: transparent;
            border: 0px solid;
        }

        th, td{
            text-align:  center;
        }

    </style>


    <script type="text/javascript">
        $(function() {
            // Handler for .ready() called.
            searchControl();
            addControl();
            tableEventHandler();
        });

        function tableEventHandler(){
            var tbl = document.getElementById("_table");
            if (tbl != null) {
                for (var i = 0; i < tbl.rows.length; i++) {
                        tbl.rows[i].cells[3].onclick = function () { controlEditUpdate(this);};
                        tbl.rows[i].cells[4].onclick = function () { controlDelete(this); };
                }
            }
        }

        function controlDelete(elm){
            var index =  $( elm ).parent().index();  
            var tbl = document.getElementById("_table");
            if (tbl != null) {
                var cll = tbl.rows[index+1].cells[1];
                var $text = $( cll ).children('input');
                deleteData($text.attr('id'));
            }
        }

        function controlEditUpdate(elm){
            var $spanIcon =  $( elm ).children('span');
            var index =  $( elm ).parent().index();  
            var tbl = document.getElementById("_table");
            
            if (tbl != null) {
                var cll = tbl.rows[index+1].cells[1];
                var $text = $( cll ).children('input');
            }

            if($spanIcon.hasClass("glyphicon glyphicon-ok") ){
                // update 
                updateInputData($text.attr('id'), $text.val());
                $spanIcon.removeClass().addClass("glyphicon glyphicon-plus");   
                $text.attr('disabled','false');
            }else if($spanIcon.hasClass("glyphicon glyphicon-plus")){
                $spanIcon.removeClass().addClass("glyphicon glyphicon-ok");
                $text.removeAttr('disabled');
            } 
        }

        function deleteData(id){
            if(id == null)
                return;

            var prms = "delete=" + id;
            $.ajax({
                url : "http://localhost:8080/HAOSA/ISGServlet",
                type: "POST",
                data : prms,
                success: function(data, textStatus, jqXHR)
                {
                    debugger;
                    alert(data.message);
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert("Error: " + textStatus);
                }
            });            
        }
 
        function updateInputData(id, text){
            if(id == null)
                return;
            if(text == null) text = "";

            var prms = "update=" + id + "&uname=" + text;
            $.ajax({
                url : "http://localhost:8080/HAOSA/ISGServlet",
                type: "POST",
                data : prms,
                success: function(data, textStatus, jqXHR)
                {
                    debugger;
                    alert(data.message);
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                    alert("Error: " + textStatus);
                }
            });
        }

        function searchControl(){
            $('#search').click(function () {
                
                var searchText = $('#txtSearch').val();
                if(searchText.length == 0)
                    return;

                var fullPath = "http://localhost:8080/HAOSA/ISGServlet?";
                var prms = "name=" + searchText;
                var path = fullPath + prms;
                $.getJSON( path, function( data ) {
                    $('#_tbody').empty();
                    var count = 1;
                    $.each( data, function( id) {  
                        $('#_tbody').append(getTableRowString(data[id], count++));
                    });
                    //
                    tableEventHandler();
                });

            });
        }


        function getTableRowString(d, count){
            var $row = $('<tr>'+
                        '<th scope="row">' + count +'</th>'+
                        '   <td>' +
                            '<input id="' + d.id + '" type="text" name="yourname" style="text-align:center;"value="'+ d.name + '" disabled="disabled"/>' +
                        '</td>'+
                        
                        '   <td>'+ d.date+ '</td>'+
                        '   <td>'+
                        '       <span class="glyphicon glyphicon-plus"></span>'+
                        '   </td>'+
                        '   <td>'+
                        '       <span class="glyphicon glyphicon-trash"></span>'+
                        '   </td>'+
                        '</tr>'
                        );

            return $row;
        }

        function addControl(){
            $('#add').click(function () {

                var addText = $('#txtSearch').val();
                if(addText.length == 0){
                    alert('Input is empty, please fill the input text');
                    return;
                }
                
                var prms = "insert=" + addText;
                $.ajax({
                    url : "http://localhost:8080/HAOSA/ISGServlet",
                    type: "POST",
                    data : prms,
                    success: function(data, textStatus, jqXHR)
                    {
                        debugger;   
                        alert(data.message);
                    },
                    error: function (jqXHR, textStatus, errorThrown)
                    {
                        alert("Error: " + textStatus);
                    }
                });
                    
            });
        }

    </script>

    <title>Document</title>
</head>
<body>  
    <div class="container" style="width: 100%; height: 100%;">
        <div style="text-align: center;">
            <h2>Security ISG Info Page</h2>
        </div>
        <div class="row">
            <div class="col-md-4 col-md-offset-4" >
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search" id="txtSearch"/>
                    <div class="input-group-btn">
                        <button id="search" class="btn btn-primary" type="submit">
                            <span class="glyphicon glyphicon-search"></span>                        
                        </button>
                        <button id="add" class="btn btn-primary" type="submit">
                                <span class="glyphicon glyphicon-plus"></span>                        
                        </button>
                </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-md-offset-3">


            <table id="_table" class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Name & Surname</th>
                        <th scope="col">Date</th>
                        <th scope="col" style="text-align: center;">Edit/Update</th>
                        <th scope="col">Delete</th>
                    </tr>
                </thead>
                <tbody id="_tbody">
                    <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td style="text-align: center;">
                            <span class="glyphicon glyphicon-plus"></span>
                        </td>
                        <td >
                            <span class="glyphicon glyphicon-trash"></span>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td >
                            <input id="etext" type="text" name="yourname" style="text-align:center;"value="Erkan Güzeler" disabled="disabled"/>
                            <!--<input id="etext" type="text" name="yourname" value="Erkan Güzeler" readonly="true" ondblclick="this.readOnly=''"/>-->
                        </td>
                        <td>Thornton</td>
                        <td>
                            <span id="spn" class="glyphicon glyphicon-plus"></span>
                        </td>
                        <td>
                            <span class="glyphicon glyphicon-trash"></span>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td>Larry</td>
                        <td>the Bird</td>
                        <td>
                            <span class="glyphicon glyphicon-plus"></span>
                        </td>
                        <td>
                            <span class="glyphicon glyphicon-trash"></span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        </div>

    </div>
</body>
</html>